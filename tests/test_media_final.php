<?php
/**
 * –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –º–µ–¥–∏–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
 */

$apiKey = '026b26ac7a206c51a216b3280042cda5178710912da68ae696a713970034dd5f';
$baseUrl = 'http://localhost:8095';

echo "üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢ –ú–ï–î–ò–ê –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–ò\n";
echo "==========================================\n";
echo "API –∫–ª—é—á: $apiKey\n";
echo "–ë–∞–∑–æ–≤—ã–π URL: $baseUrl\n\n";

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
function makeRequest($method, $url, $data = null) {
    global $apiKey;
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        "Authorization: Bearer $apiKey",
        "Content-Type: application/json"
    ]);
    
    if ($method === 'POST') {
        curl_setopt($ch, CURLOPT_POST, true);
        if ($data) {
            curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
        }
    } elseif ($method === 'PUT') {
        curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'PUT');
        if ($data) {
            curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
        }
    }
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    return [
        'code' => $httpCode,
        'response' => $response
    ];
}

echo "üì∏ –¢–ï–°–¢ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å –ø–æ–ª–Ω—ã–º –º–µ–¥–∏–∞ –Ω–∞–±–æ—Ä–æ–º\n";
echo "----------------------------------------------------\n";

$data1 = json_encode([
    'name' => '–°–º–∞—Ä—Ç—Ñ–æ–Ω Galaxy Pro',
    'vendor_article' => 'GALAXY001',
    'recommend_price' => 45000.00,
    'brand' => 'Samsung',
    'category' => '–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã',
    'description' => '–ú–æ—â–Ω—ã–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å –æ—Ç–ª–∏—á–Ω–æ–π –∫–∞–º–µ—Ä–æ–π',
    'image_urls' => [
        'https://example.com/galaxy_front.jpg',
        'https://example.com/galaxy_back.jpg',
        'https://example.com/galaxy_side.jpg',
        'https://example.com/galaxy_screen.jpg'
    ],
    'video_urls' => [
        'https://example.com/galaxy_review.mp4',
        'https://example.com/galaxy_unboxing.mp4',
        'https://example.com/galaxy_camera_test.mp4'
    ],
    'model_3d_urls' => [
        'https://example.com/galaxy_3d_model.glb',
        'https://example.com/galaxy_3d_model.obj'
    ]
]);

$result1 = makeRequest('POST', "$baseUrl/api/v1/products", $data1);
echo "POST —Å –ø–æ–ª–Ω—ã–º –º–µ–¥–∏–∞ –Ω–∞–±–æ—Ä–æ–º: HTTP $result1[code]\n";
if ($result1['code'] === 201) {
    $response1 = json_decode($result1['response'], true);
    echo "‚úÖ –ü—Ä–æ–¥—É–∫—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ\n";
    echo "ID –ø—Ä–æ–¥—É–∫—Ç–∞: " . $response1['id'] . "\n";
    if (isset($response1['media'])) {
        echo "‚úÖ –ú–µ–¥–∏–∞ –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç\n";
        $imageCount = is_array($response1['media']['image_urls']) ? count($response1['media']['image_urls']) : 0;
        $videoCount = is_array($response1['media']['video_urls']) ? count($response1['media']['video_urls']) : 0;
        $modelCount = is_array($response1['media']['model_3d_urls']) ? count($response1['media']['model_3d_urls']) : 0;
        echo "üì∏ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: $imageCount\n";
        echo "üé• –í–∏–¥–µ–æ: $videoCount\n";
        echo "üéÆ 3D –º–æ–¥–µ–ª–µ–π: $modelCount\n";
    } else {
        echo "‚ùå –ú–µ–¥–∏–∞ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –æ—Ç–≤–µ—Ç–µ\n";
    }
} else {
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: $result1[response]\n";
}

echo "\nüì∏ –¢–ï–°–¢ 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ —Ç–æ–ª—å–∫–æ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏\n";
echo "----------------------------------------------------\n";

$data2 = json_encode([
    'name' => '–§—É—Ç–±–æ–ª–∫–∞ —Ö–ª–æ–ø–∫–æ–≤–∞—è',
    'vendor_article' => 'TSHIRT001',
    'recommend_price' => 1500.00,
    'brand' => 'CottonBrand',
    'category' => '–û–¥–µ–∂–¥–∞',
    'description' => '–ú—è–≥–∫–∞—è —Ö–ª–æ–ø–∫–æ–≤–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞',
    'image_urls' => [
        'https://example.com/tshirt_front.jpg',
        'https://example.com/tshirt_back.jpg'
    ]
]);

$result2 = makeRequest('POST', "$baseUrl/api/v1/products", $data2);
echo "POST —Ç–æ–ª—å–∫–æ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏: HTTP $result2[code]\n";
if ($result2['code'] === 201) {
    echo "‚úÖ –ü—Ä–æ–¥—É–∫—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ\n";
} else {
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: $result2[response]\n";
}

echo "\nüì∏ –¢–ï–°–¢ 3: –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –º–µ–¥–∏–∞\n";
echo "------------------------------------------------\n";

$batchData = json_encode([
    'products' => [
        [
            'name' => '–ù–∞—É—à–Ω–∏–∫–∏ Wireless',
            'vendor_article' => 'HEADPHONES001',
            'recommend_price' => 3500.00,
            'brand' => 'AudioTech',
            'category' => '–ê—É–¥–∏–æ',
            'description' => '–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏',
            'image_urls' => [
                'https://example.com/headphones_main.jpg',
                'https://example.com/headphones_case.jpg'
            ],
            'video_urls' => [
                'https://example.com/headphones_review.mp4'
            ]
        ],
        [
            'name' => '–ö–Ω–∏–≥–∞ "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Go"',
            'vendor_article' => 'BOOK001',
            'recommend_price' => 2500.00,
            'brand' => 'TechBooks',
            'category' => '–ö–Ω–∏–≥–∏',
            'description' => '–£—á–µ–±–Ω–∏–∫ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é',
            'image_urls' => [
                'https://example.com/book_cover.jpg',
                'https://example.com/book_pages.jpg'
            ]
        ]
    ]
]);

$result3 = makeRequest('POST', "$baseUrl/api/v1/products/batch", $batchData);
echo "POST –ø–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ: HTTP $result3[code]\n";
if ($result3['code'] === 201) {
    $response3 = json_decode($result3['response'], true);
    echo "‚úÖ –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ\n";
    echo "–°–æ–∑–¥–∞–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: " . count($response3) . "\n";
} else {
    echo "‚ùå –û—à–∏–±–∫–∞ –ø–∞–∫–µ—Ç–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è: $result3[response]\n";
}

echo "\nüì∏ –¢–ï–°–¢ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞ –ø—Ä–æ–¥—É–∫—Ç–∞\n";
echo "------------------------------------\n";

if ($result1['code'] === 201) {
    $response1 = json_decode($result1['response'], true);
    $productId = $response1['id'];
    
    $updateData = json_encode([
        'image_urls' => [
            'https://example.com/galaxy_new_front.jpg',
            'https://example.com/galaxy_new_back.jpg',
            'https://example.com/galaxy_new_side.jpg'
        ],
        'video_urls' => [
            'https://example.com/galaxy_new_review.mp4',
            'https://example.com/galaxy_new_camera.mp4'
        ],
        'model_3d_urls' => [
            'https://example.com/galaxy_new_3d.glb'
        ]
    ]);
    
    $result4 = makeRequest('PUT', "$baseUrl/api/v1/products/$productId", $updateData);
    echo "PUT –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞: HTTP $result4[code]\n";
    if ($result4['code'] === 200) {
        $response4 = json_decode($result4['response'], true);
        echo "‚úÖ –ü—Ä–æ–¥—É–∫—Ç –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ\n";
        if (isset($response4['media'])) {
            $imageCount = is_array($response4['media']['image_urls']) ? count($response4['media']['image_urls']) : 0;
            $videoCount = is_array($response4['media']['video_urls']) ? count($response4['media']['video_urls']) : 0;
            $modelCount = is_array($response4['media']['model_3d_urls']) ? count($response4['media']['model_3d_urls']) : 0;
            echo "üì∏ –û–±–Ω–æ–≤–ª–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: $imageCount\n";
            echo "üé• –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤–∏–¥–µ–æ: $videoCount\n";
            echo "üéÆ –û–±–Ω–æ–≤–ª–µ–Ω–æ 3D –º–æ–¥–µ–ª–µ–π: $modelCount\n";
        }
    } else {
        echo "‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: $result4[response]\n";
    }
}

echo "\nüì∏ –¢–ï–°–¢ 5: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –º–µ–¥–∏–∞\n";
echo "---------------------------------------------\n";

$result5 = makeRequest('GET', "$baseUrl/api/v1/products");
echo "GET —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: HTTP $result5[code]\n";
if ($result5['code'] === 200) {
    $response5 = json_decode($result5['response'], true);
    echo "‚úÖ –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω\n";
    echo "–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: " . $response5['total'] . "\n";
    
    $productsWithMedia = 0;
    foreach ($response5['data'] as $product) {
        if (isset($product['media'])) {
            $productsWithMedia++;
        }
    }
    echo "–ü—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –º–µ–¥–∏–∞: $productsWithMedia\n";
} else {
    echo "‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞: $result5[response]\n";
}

echo "\nüéâ –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:\n";
echo "======================\n";
echo "‚úÖ –¢–∞–±–ª–∏—Ü–∞ media —Å–æ–∑–¥–∞–Ω–∞ —Å JSON –ø–æ–ª—è–º–∏\n";
echo "‚úÖ –ú–æ–¥–µ–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–µ–¥–∏–∞\n";
echo "‚úÖ –°–µ—Ä–≤–∏—Å –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ–¥–∏–∞\n";
echo "‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ–¥–∏–∞\n";
echo "‚úÖ –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –º–µ–¥–∏–∞\n";
echo "‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ –¥–∞–Ω–Ω—ã—Ö\n";
echo "\nüìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:\n";
echo "–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ–¥–∏–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –ø—Ä–æ–¥—É–∫—Ç–æ–≤:\n";
echo "1. ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)\n";
echo "2. ‚úÖ –í–∏–¥–µ–æ –æ–±–∑–æ—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)\n";
echo "3. ‚úÖ 3D –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)\n";
echo "4. ‚úÖ JSON —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–æ–≤ URL\n";
echo "5. ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n";
echo "6. ‚úÖ –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞\n";
echo "7. ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API –ø—Ä–æ–¥—É–∫—Ç–æ–≤\n";
?> 