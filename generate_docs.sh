#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑ openapi.json
cd /var/www/trading

echo "üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑ openapi.json..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ openapi.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if [ ! -f "openapi.json" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: openapi.json –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é Redoc
echo "üìù –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
npx redoc-cli build openapi.json -o redoc-documentation.html

if [ $? -eq 0 ]; then
    echo "‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞!"
    echo "üåê –î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: http://docs.portaldata.ru:8090"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"
    exit 1
fi
