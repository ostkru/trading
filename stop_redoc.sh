#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ Redoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
# –ê–≤—Ç–æ—Ä: AI Assistant
# –î–∞—Ç–∞: $(date)

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Redoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."

# –ò—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã redoc-cli
REDOC_PIDS=$(pgrep -f "redoc-cli serve")

if [ -z "$REDOC_PIDS" ]; then
    echo "‚ÑπÔ∏è  Redoc —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    exit 0
fi

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üìã –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã Redoc: $REDOC_PIDS"
for pid in $REDOC_PIDS; do
    echo "üîÑ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ $pid..."
    kill $pid 2>/dev/null
done

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
sleep 2

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
REMAINING_PIDS=$(pgrep -f "redoc-cli serve")
if [ -z "$REMAINING_PIDS" ]; then
    echo "‚úÖ Redoc —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: $REMAINING_PIDS"
    echo "üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
    kill -9 $REMAINING_PIDS 2>/dev/null
    echo "‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ—Ä—Ç 8090 —Å–≤–æ–±–æ–¥–µ–Ω
if ! netstat -tlnp 2>/dev/null | grep -q ":8090"; then
    echo "‚úÖ –ü–æ—Ä—Ç 8090 —Å–≤–æ–±–æ–¥–µ–Ω"
else
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8090 –≤—Å–µ –µ—â–µ –∑–∞–Ω—è—Ç"
fi

