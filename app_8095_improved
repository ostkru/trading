#!/bin/bash

# Улучшенная версия сервера с graceful shutdown
cd /var/www/go

# Функция для graceful shutdown
cleanup() {
    echo "Получен сигнал остановки, завершаем работу..."
    if [ -f server.pid ]; then
        kill $(cat server.pid) 2>/dev/null
        rm -f server.pid
    fi
    exit 0
}

# Обработка сигналов
trap cleanup SIGTERM SIGINT

# Запуск сервера
echo "Запуск PortalData API сервера..."
./app_8095 &
SERVER_PID=$!

# Сохранение PID
echo $SERVER_PID > server.pid

# Ожидание завершения
wait $SERVER_PID 