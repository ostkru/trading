# Отчет об исправлении поля is_public

## Проблема
Поле `is_public` в таблице `offers` не имело значения по умолчанию, что приводило к:
1. Ошибкам при чтении NULL значений из базы данных
2. Неясности в API документации о том, какое значение используется по умолчанию

## Внесенные изменения

### 1. Go код (internal/modules/offer/service.go)
- ✅ Добавлена установка значения по умолчанию `true` для поля `is_public`
- ✅ Если `req.IsPublic` равен `nil`, используется значение `true`

```go
// Устанавливаем значение по умолчанию для is_public
isPublic := true
if req.IsPublic != nil {
    isPublic = *req.IsPublic
}
```

### 2. База данных
- ✅ **MySQL** (`restore_db_structure_mysql.sql`): `is_public BOOLEAN DEFAULT 1`
- ✅ Создан скрипт `fix_is_public_default.sql` для обновления существующих NULL значений

### 3. API документация (openapi.json)
- ✅ Удален файл `openapi.yaml` (оставлена только JSON документация)
- ✅ Поле `is_public` удалено из списка обязательных полей в `CreateOfferRequest`
- ✅ Добавлено описание с значением по умолчанию: `"default": true`
- ✅ Обновлено описание: `"Публичный оффер или нет. По умолчанию true."`

### 4. Структура API
- ✅ **CreateOfferRequest**: `is_public` - необязательное поле с default=true
- ✅ **UpdateOfferRequest**: `is_public` - опциональное поле для изменения статуса
- ✅ **Offer**: `is_public` - поле с описанием

## Результат
1. **По умолчанию**: все новые офферы создаются как публичные (`is_public = true`)
2. **Явное указание**: можно передать `"is_public": false` для создания приватного оффера
3. **Обратная совместимость**: существующие офферы с NULL значениями будут исправлены скриптом
4. **Документация**: четко указано значение по умолчанию в API спецификации

## Тестирование
Для проверки изменений можно использовать:
- `test_final_changes.php` - тестирует создание офферов без указания `is_public`
- `comprehensive_api_test.php` - комплексное тестирование API

## Команды для применения изменений
```bash
# Применить исправления в базе данных
mysql -u root -p123456 portaldata -e "UPDATE offers SET is_public = 1 WHERE is_public IS NULL;"

# Пересобрать приложение
go build -o app cmd/api/main.go
``` 