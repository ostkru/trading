# üó∫Ô∏è API –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –§–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è Offers

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è offers, –≤–∫–ª—é—á–∞—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã–º–∏ –æ–±–ª–∞—Å—Ç—è–º–∏ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º.

## üÜï –ù–æ–≤—ã–µ Endpoints

### 1. –§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ Offers (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)
```
POST /api/v1/offers/filter
```

### 2. –§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –ü—É–±–ª–∏—á–Ω—ã–µ Offers (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
```
POST /api/v1/offers/public/filter
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤

### OfferFilterRequest
```json
{
  "filter": "all",                    // my, others, all
  "offer_type": "sale",              // sale, buy
  "geographic": {                     // –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä
    "min_latitude": 55.0,
    "max_latitude": 56.0,
    "min_longitude": 37.0,
    "max_longitude": 38.0
  },
  "price_min": 100,                  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
  "price_max": 5000,                 // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
  "available_lots": 1                // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ—Ç–æ–≤
}
```

## üó∫Ô∏è –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä

### GeographicFilter
```json
{
  "min_latitude": 55.0,    // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–æ—Ç–∞
  "max_latitude": 56.0,    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–æ—Ç–∞
  "min_longitude": 37.0,   // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–æ–ª–≥–æ—Ç–∞
  "max_longitude": 38.0    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–æ–ª–≥–æ—Ç–∞
}
```

**–ü—Ä–∏–º–µ—Ä—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:**
- **–ú–æ—Å–∫–≤–∞**: 55.0-56.0, 37.0-38.0
- **–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥**: 59.0-60.0, 30.0-31.0
- **–í–µ—Å—å –º–∏—Ä**: 0-90, 0-180

## üí∞ –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ü–µ–Ω–µ

```json
{
  "price_min": 100,    // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
  "price_max": 5000    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
}
```

## üì¶ –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

```json
{
  "available_lots": 1    // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ—Ç–æ–≤
}
```

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤—ã–π –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä
```bash
curl -X POST http://localhost:8095/api/v1/offers/filter \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "filter": "all",
    "geographic": {
      "min_latitude": 55.0,
      "max_latitude": 56.0,
      "min_longitude": 37.0,
      "max_longitude": 38.0
    }
  }'
```

### 2. –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ
```bash
curl -X POST http://localhost:8095/api/v1/offers/filter \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "filter": "all",
    "price_min": 100,
    "price_max": 5000
  }'
```

### 3. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
```bash
curl -X POST http://localhost:8095/api/v1/offers/filter \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "filter": "all",
    "offer_type": "sale",
    "geographic": {
      "min_latitude": 55.0,
      "max_latitude": 56.0,
      "min_longitude": 37.0,
      "max_longitude": 38.0
    },
    "price_min": 500,
    "available_lots": 1
  }'
```

### 4. –ü—É–±–ª–∏—á–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
```bash
curl -X POST http://localhost:8095/api/v1/offers/public/filter \
  -H "Content-Type: application/json" \
  -d '{
    "offer_type": "buy",
    "geographic": {
      "min_latitude": 55.0,
      "max_latitude": 56.0,
      "min_longitude": 37.0,
      "max_longitude": 38.0
    },
    "price_max": 3000
  }'
```

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

–í—Å–µ endpoints –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏:

```
?page=1&limit=20
```

- `page` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1) - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 20, –º–∞–∫—Å–∏–º—É–º: 100) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (`/offers/filter`)
- –¢—Ä–µ–±—É—é—Ç Bearer token
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä—ã `my`, `others`, `all`
- –í–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—Ñ—Ñ–µ—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—É–±–ª–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (`/offers/public/filter`)
- –ù–µ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –í–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã (`is_public = true`)
- –ò–≥–Ω–æ—Ä–∏—Ä—É—é—Ç —Ñ–∏–ª—å—Ç—Ä `filter`

## ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- `filter`: `my`, `others`, `all`
- `offer_type`: `sale`, `buy`
- `geographic`: –≤—Å–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏
- `price_min`, `price_max`: –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞
- `available_lots`: –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ

### –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
- `400 Bad Request` - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON –∏–ª–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- `401 Unauthorized` - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `500 Internal Server Error` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

## üìà –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "offers": [
    {
      "offer_id": 164,
      "user_id": 6,
      "created_at": "2025-07-25T07:00:34Z",
      "updated_at": "2025-07-25T07:00:34Z",
      "is_public": true,
      "product_id": 192,
      "price_per_unit": 2000,
      "tax_nds": 20,
      "units_per_lot": 1,
      "available_lots": 8,
      "latitude": 55.7558,
      "longitude": 37.6176,
      "warehouse_id": 80,
      "offer_type": "buy",
      "max_shipping_days": 5,
      "product_name": "–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç",
      "vendor_article": "TEST001",
      "recommend_price": 2500,
      "warehouse_name": "–°–∫–ª–∞–¥ –≤ –ú–æ—Å–∫–≤–µ",
      "warehouse_address": "—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 1"
    }
  ],
  "total": 1,
  "page": 1,
  "limit": 20
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤:

```bash
php test_geographic_filters.php
```

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã** —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ —Å–∫–ª–∞–¥–æ–≤ (`warehouses.latitude`, `warehouses.longitude`)
2. **–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏** –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —á–µ—Ç—ã—Ä—å–º—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
3. **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã** –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ SQL `AND` —É—Å–ª–æ–≤–∏—è
4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –∏ —Ü–µ–Ω–∞–º
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ prepared statements

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–µ—Å—è—Ç–∏—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (WGS84)
- –®–∏—Ä–æ—Ç–∞: -90 –¥–æ +90
- –î–æ–ª–≥–æ—Ç–∞: -180 –¥–æ +180
- –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí —Ç–∏–ø ‚Üí –≥–µ–æ–≥—Ä–∞—Ñ–∏—è ‚Üí —Ü–µ–Ω–∞ ‚Üí –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å 