#!/bin/bash

# ะกะบัะธะฟั ะดะปั ะทะฐะฟััะบะฐ Redoc ะดะพะบัะผะตะฝัะฐัะธะธ
# ะะฒัะพั: AI Assistant
# ะะฐัะฐ: $(date)

echo "๐ ะะฐะฟััะบ Redoc ะดะพะบัะผะตะฝัะฐัะธะธ ะฝะฐ ะฟะพััั 8090..."

# ะัะพะฒะตััะตะผ, ััะพ npx ะดะพัััะฟะตะฝ
if ! command -v npx &> /dev/null; then
    echo "โ ะัะธะฑะบะฐ: npx ะฝะต ะฝะฐะนะดะตะฝ. ะฃััะฐะฝะพะฒะธัะต Node.js ะธ npm"
    exit 1
fi

# ะัะพะฒะตััะตะผ ะฝะฐะปะธัะธะต openapi.json
if [ ! -f "openapi.json" ]; then
    echo "โ ะัะธะฑะบะฐ: ะคะฐะนะป openapi.json ะฝะต ะฝะฐะนะดะตะฝ"
    exit 1
fi

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฟัะตะดัะดััะธะน ะฟัะพัะตัั, ะตัะปะธ ะพะฝ ะทะฐะฟััะตะฝ
pkill -f "redoc-cli serve" 2>/dev/null
sleep 2

# ะะฐะฟััะบะฐะตะผ redoc ัะตัะฒะตั ั ะฒะฝะตัะฝะธะผ ะดะพัััะฟะพะผ
echo "๐ ะะฐะฟััะบ ัะตัะฒะตัะฐ ะดะพะบัะผะตะฝัะฐัะธะธ ั ะฒะฝะตัะฝะธะผ ะดะพัััะฟะพะผ..."
npx redoc-cli serve openapi.json --port 8090 --host 0.0.0.0 > redoc.log 2>&1 &

# ะะดะตะผ ะฝะตะผะฝะพะณะพ ะธ ะฟัะพะฒะตััะตะผ ััะฐััั
sleep 3
if curl -s http://localhost:8090 > /dev/null; then
    echo "โ Redoc ะดะพะบัะผะตะฝัะฐัะธั ััะฟะตัะฝะพ ะทะฐะฟััะตะฝะฐ!"
    echo "๐ ะะพะบะฐะปัะฝัะน ะดะพัััะฟ: http://localhost:8090"
    echo "๐ ะะฝะตัะฝะธะน ะดะพัััะฟ: http://92.53.64.38:8090"
    echo "๐ ะะพะณะธ ัะพััะฐะฝััััั ะฒ ัะฐะนะป: redoc.log"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ. ะัะพะฒะตัััะต ะปะพะณะธ ะฒ redoc.log"
    exit 1
fi
