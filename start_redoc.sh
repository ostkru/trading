#!/bin/bash

# ะกะบัะธะฟั ะดะปั ะทะฐะฟััะบะฐ Redoc ัะตัะฒะตัะฐ ั ะดะพะบัะผะตะฝัะฐัะธะตะน PortalData API

PORT=8182
OPENAPI_FILE="openapi.json"
PID_FILE="redoc.pid"

echo "๐ ะะฐะฟััะบ Redoc ัะตัะฒะตัะฐ ะดะปั PortalData API..."

# ะัะพะฒะตััะตะผ, ััะพ ัะฐะนะป OpenAPI ัััะตััะฒัะตั
if [ ! -f "$OPENAPI_FILE" ]; then
    echo "โ ะัะธะฑะบะฐ: ะคะฐะนะป $OPENAPI_FILE ะฝะต ะฝะฐะนะดะตะฝ!"
    exit 1
fi

# ะัะพะฒะตััะตะผ, ะฝะต ะทะฐะฟััะตะฝ ะปะธ ัะถะต ัะตัะฒะตั
if [ -f "$PID_FILE" ]; then
    PID=$(cat "$PID_FILE")
    if ps -p $PID > /dev/null 2>&1; then
        echo "โ๏ธ  Redoc ัะตัะฒะตั ัะถะต ะทะฐะฟััะตะฝ ะฝะฐ ะฟะพััั $PORT (PID: $PID)"
        echo "๐ ะะพะบัะผะตะฝัะฐัะธั ะดะพัััะฟะฝะฐ ะฟะพ ะฐะดัะตัั: http://localhost:$PORT"
        exit 0
    else
        echo "๐งน ะฃะดะฐะปัะตะผ ััะฐััะน PID ัะฐะนะป..."
        rm -f "$PID_FILE"
    fi
fi

# ะะฐะฟััะบะฐะตะผ Redoc ัะตัะฒะตั ะฝะฐ ะฒัะตั ะธะฝัะตััะตะนัะฐั
echo "๐ ะะฐะฟััะบ ะดะพะบัะผะตะฝัะฐัะธะธ ะฝะฐ ะฟะพััั $PORT (ะดะพัััะฟะฝะพ ะธะทะฒะฝะต)..."
npx redoc-cli serve "$OPENAPI_FILE" --port "$PORT" --host "0.0.0.0" &
REDOC_PID=$!

# ะกะพััะฐะฝัะตะผ PID
echo $REDOC_PID > "$PID_FILE"

# ะะดะตะผ ะฝะตะผะฝะพะณะพ ะดะปั ะทะฐะฟััะบะฐ
sleep 3

# ะัะพะฒะตััะตะผ, ััะพ ัะตัะฒะตั ะทะฐะฟัััะธะปัั
if ps -p $REDOC_PID > /dev/null 2>&1; then
    echo "โ Redoc ัะตัะฒะตั ััะฟะตัะฝะพ ะทะฐะฟััะตะฝ!"
    echo "๐ ะะพะบัะผะตะฝัะฐัะธั ะดะพัััะฟะฝะฐ ะฟะพ ะฐะดัะตัั: http://localhost:$PORT"
    echo "๐ PID: $REDOC_PID"
    echo "๐ก ะะปั ะพััะฐะฝะพะฒะบะธ ัะตัะฒะตัะฐ ะฒัะฟะพะปะฝะธัะต: ./stop_redoc.sh"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ Redoc ัะตัะฒะตัะฐ"
    rm -f "$PID_FILE"
    exit 1
fi 